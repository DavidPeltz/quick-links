<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Quick Links</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <!-- Add Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #2d3748; /* dark-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #4a5568; /* dark-600 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #718096; /* dark-500 */
        }
    </style>
</head>
<body class="bg-gray-900 text-white font-sans h-full flex items-center justify-center p-4">

    <div class="w-full max-w-2xl bg-gray-800 rounded-lg shadow-2xl p-6 md:p-8">
        
        <!-- Header -->
        <div class="flex items-center justify-between mb-6">
            <h1 class="text-2xl md:text-3xl font-bold text-cyan-400">My Quick Links</h1>
            <!-- Container for status and buttons -->
            <div class="flex items-center space-x-4">
                <!-- NEW: Upload Button -->
                <button id="upload-links-btn" class="text-gray-400 hover:text-white transition duration-200" title="Upload links from JSON">
                    <i class="fas fa-upload fa-lg"></i>
                </button>
                <button id="download-links-btn" class="text-gray-400 hover:text-white transition duration-200" title="Download links as JSON">
                    <i class="fas fa-download fa-lg"></i>
                </button>
                <span class="text-xs text-gray-500">Local Storage Mode</span>
            </div>
        </div>

        <!-- Add New Link Form -->
        <form id="add-link-form" class="mb-6 grid grid-cols-1 md:grid-cols-5 gap-3">
            <input type="text" id="link-name" placeholder="Link Name (e.g., Tech Hub)" required class="md:col-span-2 bg-gray-700 text-white border border-gray-600 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-cyan-500" />
            <input type="url" id="link-url" placeholder="Full URL (e.g., https://...)" required class="md:col-span-2 bg-gray-700 text-white border border-gray-600 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-cyan-500" />
            <button type="submit" class="md:col-span-1 bg-cyan-600 hover:bg-cyan-700 text-white font-semibold py-2 px-4 rounded-md transition duration-200 shadow-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-offset-2 focus:ring-offset-gray-800">
                Add Link
            </button>
        </form>
        
        <!-- NEW: Hidden file input -->
        <input type="file" id="file-uploader" class="hidden" accept="application/json">
        
        <div id="error-message" class="text-red-400 text-sm mb-4 hidden"></div>

        <!-- Links List -->
        <div class="space-y-3 max-h-96 overflow-y-auto pr-2" id="links-container">
            <!-- Links will be dynamically inserted here -->
            <div id="loading-spinner" class="flex justify-center items-center h-24">
                <i class="fas fa-spinner fa-spin fa-2x text-gray-500"></i>
                <span class="ml-3 text-gray-500">Loading links...</span>
            </div>
        </div>
        
    </div>

    <!-- Simplified JavaScript using localStorage -->
    <script>
        // --- UI Elements ---
        const addLinkForm = document.getElementById('add-link-form');
        const linkNameInput = document.getElementById('link-name');
        const linkUrlInput = document.getElementById('link-url');
        const linksContainer = document.getElementById('links-container');
        const errorMessage = document.getElementById('error-message');
        const loadingSpinner = document.getElementById('loading-spinner');
        
        // --- New/Updated Elements ---
        const downloadBtn = document.getElementById('download-links-btn');
        const uploadBtn = document.getElementById('upload-links-btn');
        const fileUploader = document.getElementById('file-uploader');
        
        const STORAGE_KEY = 'my-quick-links';

        // --- Link Management Functions ---

        /**
         * Gets all links from localStorage.
         * @returns {Array} An array of link objects.
         */
        function getLinks() {
            const linksJson = localStorage.getItem(STORAGE_KEY);
            try {
                return linksJson ? JSON.parse(linksJson) : [];
            } catch (e) {
                console.error("Error parsing links from localStorage", e);
                return [];
            }
        }

        /**
         * Saves an array of links to localStorage.
         * @param {Array} linksArray - The array of link objects to save.
         */
        function saveLinks(linksArray) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(linksArray));
        }

        /**
         * Renders the list of links in the UI.
         */
        function renderLinks() {
            const links = getLinks();
            loadingSpinner.classList.add('hidden'); // Hide spinner
            
            linksContainer.innerHTML = ''; // Clear the container

            if (links.length === 0) {
                linksContainer.innerHTML = `<p id="no-links-message" class="text-gray-500 text-center">No links added yet. Use the form above to add one!</p>`;
                return;
            }

            links.forEach((link, index) => {
                const linkElement = document.createElement('div');
                linkElement.className = "bg-gray-700 p-4 rounded-lg flex items-center justify-between shadow-md";
                linkElement.innerHTML = `
                    <button class="redirect-button text-lg font-medium text-cyan-300 hover:text-cyan-200 hover:underline truncate" data-url="${link.url}">
                        ${link.name}
                    </button>
                    <button class="delete-button text-gray-500 hover:text-red-400 transition duration-200" data-index="${index}">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                `;
                linksContainer.appendChild(linkElement);
            });
            
            // Add event listeners after rendering
            addLinkEventListeners();
        }

        /**
         * Adds click handlers for redirect and delete buttons.
         */
        function addLinkEventListeners() {
            // Redirect buttons
            document.querySelectorAll('.redirect-button').forEach(button => {
                button.onclick = (e) => {
                    const url = e.currentTarget.getAttribute('data-url');
                    if (url) {
                        window.open(url, '_blank');
                    }
                };
            });

            // Delete buttons
            document.querySelectorAll('.delete-button').forEach(button => {
                button.onclick = (e) => {
                    const index = parseInt(e.currentTarget.getAttribute('data-index'), 10);
                    if (confirm("Are you sure you want to delete this link?")) {
                        deleteLink(index);
                    }
                };
            });
        }
        
        /**
         * Deletes a link by its index.
         * @param {number} index - The index of the link to delete.
         */
        function deleteLink(index) {
            let links = getLinks();
            links.splice(index, 1); // Remove the link at the specified index
            saveLinks(links);
            renderLinks(); // Re-render the UI
        }

        /**
         * Handles the submission of the "Add Link" form.
         */
        addLinkForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = linkNameInput.value.trim();
            const url = linkUrlInput.value.trim();

            if (!name || !url) {
                showError("Please provide both a name and a URL.");
                return;
            }

            if (!isValidUrl(url)) {
                showError("Please enter a valid URL (e.g., https://google.com).");
                return;
            }

            try {
                let links = getLinks();
                links.push({ name, url });
                saveLinks(links);
                
                // Clear form and error
                linkNameInput.value = '';
                linkUrlInput.value = '';
                showError(""); // Clear error
                
                renderLinks(); // Re-render the UI
                
            } catch (error) {
                console.error("Error adding link:", error);
                showError("Failed to add link. Please try again.");
            }
        });

        // --- Utility Functions ---
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.toggle('hidden', !message); // Show if message, hide if not
        }

        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }
        
        window.confirm = (message) => {
            // This is a bypass for the iframe environment. 
            // In a real browser, this would show a native dialog.
            return true; 
        };

        // --- Start Application ---
        function initializeApp() {
            
            // --- Download Button Listener ---
            downloadBtn.addEventListener('click', () => {
                try {
                    const links = getLinks();
                    if (links.length === 0) {
                        showError("No links to download.");
                        setTimeout(() => showError(""), 3000); 
                        return;
                    }
                    
                    const linksJson = JSON.stringify(links, null, 2);
                    const blob = new Blob([linksJson], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    
                    a.href = url;
                    a.download = 'my-quick-links.json';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                } catch (error) {
                    console.error("Error downloading links:", error);
                    showError("Failed to download links.");
                }
            });

            // --- Upload Button Listeners ---
            
            // 1. When the visible upload icon is clicked, trigger the hidden file input
            uploadBtn.addEventListener('click', () => {
                fileUploader.click();
            });

            // 2. When a file is selected in the file dialog
            fileUploader.addEventListener('change', (e) => {
                const file = e.target.files[0];
                
                if (!file) {
                    return; // User cancelled
                }
                
                if (file.type !== "application/json") {
                    showError("Please upload a valid .json file.");
                    e.target.value = null; // Reset input
                    return;
                }
                
                const reader = new FileReader();
                
                // This function runs after the file is read
                reader.onload = (event) => {
                    try {
                        const jsonContent = event.target.result;
                        const uploadedLinks = JSON.parse(jsonContent);

                        // --- Validation ---
                        if (!Array.isArray(uploadedLinks)) {
                            throw new Error("JSON file is not a valid link array.");
                        }

                        // Validate object structure (check first item)
                        if (uploadedLinks.length > 0) {
                            const firstLink = uploadedLinks[0];
                            if (typeof firstLink.name === 'undefined' || typeof firstLink.url === 'undefined') {
                                throw new Error("JSON items are missing 'name' or 'url'.");
                            }
                        }
                        // --- End Validation ---

                        // Ask for confirmation
                        if (confirm("This will OVERWRITE your current list of links. Are you sure you want to restore from this backup?")) {
                            saveLinks(uploadedLinks); // Save to localStorage
                            renderLinks(); // Update the UI
                            
                            showError("Links successfully imported!");
                            setTimeout(() => showError(""), 3000); // Clear after 3s
                        }
                        
                    } catch (err) {
                        console.error("Error reading or parsing file:", err);
                        showError("Error: Could not import links. File may be corrupt.");
                    } finally {
                        // Reset the file input so 'change' fires again
                        // even if the same file is selected
                        e.target.value = null;
                    }
                };
                
                reader.onerror = () => {
                    console.error("Error reading file");
                    showError("An error occurred while reading the file.");
                };
                
                // Start reading the file as text
                reader.readAsText(file);
CSS
            });


            // --- Load Initial Data ---
            const links = getLinks();
            if (links.length === 0) {
                // If no links exist, add the default one
                console.log("No links found. Adding default 'Tech Hub' link.");
                const defaultLink = {
                    name: "Tech Hub",
                    url: "https://demo-media-retail-site.pages.dev"
                };
                saveLinks([defaultLink]);
            }
            // Render whatever is in storage
            renderLinks();
        }

        initializeApp();

    </script>
</body>
</html>